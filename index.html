<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<title>Mplatform by ParkMinKyu</title>
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
	<style type="text/css">
	html,body { height: 100%; margin: 0; padding: 0; font-family: "Nanum Gothic",sans-serif; font-size: 13px;}
	h3 {margin-bottom : 0; font-size: 16px; font-weight:bold;}
	#main {
	min-height: 100%; 
	position: relative;
	margin: 0 auto;
	overflow: scroll;
	}
	 
	#weather{
	width: 190px;
	    float: right;
	    margin-top: 5px;
	}
	
    #weather > div
	{
	margin-top: 5px;
	vertical-align : middle;
	}
	 
	#container #header {
	height: 70px;
	background-color: white;
	}
	 
	#container #content {
	padding-bottom: 50px;
	}
	 
	#container #footer {
	position: absolute;
	bottom: 0;
	width: 100%;
	height: 50px;
	background-color: silver;
	}
	
	#pageNo2,#pageNo3,#pageNo4{
		padding : 5px;
	}
	
	#areaList > div
	{
		border: 1px solid #82a56f;
		background : #a5ca97;
	    padding: 5px;
	    margin-top: 5px;
		width: 45%;
		float: left;
		margin-right: 5px;
		text-align:center;
		height : 17px;
	}
	
	#parkList > div{
		border: 1px solid #82a56f;
	    height: 75px;
	    padding: 5px;
	    margin-top: 5px;
	    font-weight : bold;
		color : #333333;
	}
	#programName{
		font-weight:bold;
		color : #333333;
	}
	#infoName{
		font-size : 14px;
		font-weight:bold;
	}
	#detailArea{
		margin: 0;
		list-style: none;
		padding: 0;
	}
	.detailBtn{
	    font-weight:normal ;
		margin-top: 10px;
	}
	#parkProgramList > div{
		border: 1px solid #82a56f;
	    height: 100%;
	    padding: 15px;
	    margin-top: 5px;
	}
	
	#parkList{
	  max-height: 350px;
      overflow: scroll;
	}		
	
	#pageNo3 #parkList img{
	 margin-right :8px;
	 margin-top :8px;
	}
	
    #pageNo4 #parkProgramList img{
     margin-right :8px;
	 margin-top :8px;
	}
	
	#pageNo1{
		background: url(bg_park.gif)no-repeat;
		background-size: cover;
		height: 100%;
		width: 100%;
		position: absolute;
		text-align: center;
	}
	.mgt150 {
		margin-top: 150px !important;
	}
	.mgb0 {
		 bottom: 0px; position: absolute; text-align:center; width:100%; z-index:100;
	}
		
.blind {
    font-size: 0;
    height: 0;
    left: -9999px;
    line-height: 0;
    position: absolute;
    top: -9999px;
    width: 0;
}
	
	</style>
</head>
<body>
<!--<div id="header" style="background: url(header.png)no-repeat;background-size: 100%;display:none;height:39px;">-->
<div id="header" style="background-color:#7ac6de;height:39px;text-align:center;width:100%; display:none;">
	<img id="backBtn" src="back.png" style="margin-top: 4px; margin-left: 6px; position: absolute;">
	<img id="logo" src="btn_logo2.png" style="margin-top:5px;">
</div>
<div id="main">
	<input type="hidden" id="pageIdx" value="0">
	<input type="hidden" id="parkName" value="">
	<input type="hidden" id="lat" value="">
	<input type="hidden" id="lng" value="">
	<input type="hidden" id="targetName" value="">
	<input type="hidden" id="targetLat" value="">
	<input type="hidden" id="targetLng" value="">
	<input type="hidden" id="contentTypeId" value="">
	<input type="hidden" id="areaCode" value="1">
	<input type="hidden" id="sigunguCode" value="">

	<div id="pageNo1">
		<img src="btn_logo.png" class="mgt150">
		<div class="mgb0">
			<img src="img_main01.png">
		</div>
	</div>

	<div id="pageNo2" style="display: none;">
		<h3>ㆍ지역별 공원 현황</h3>
		<div id="areaList" style="text-align:center;">
		</div>
	</div>
	<div id="pageNo3" style=" display: none;">
		<h3>ㆍ<span id="areaPark"></span> 공원 목록</h3>
		<div id="parkList">
		</div>
		<div style="text-align:center; margin-top:5px;">
		<img src="btn_arrow.png" alt="아래로 이동">
		</div>
		<div id="weather">
			<h4 style="margin:0;">ㆍ<span id="weatherArea"></span> 날씨</h4>
			<span id="SKY"><span></span></span>/<span id="T1H"><span></span>℃</span><br>			
			<span id="PTY">ㆍ강수형태 : <span></span></span>/<span id="RN1"><span></span>mm</span><br>
			<span id="pm10Value">ㆍ미세먼지 : <span></span>㎍/㎥</span>
		</div>
	</div>
	<div id="pageNo4" style="display: none;">
		<h3>ㆍ<span id="parkInfo"></span> 정보</h3>
		<div id="parkProgramList">
		</div>
	</div>
</div>
<div id="footer" style="display:none;">
	<img id="backBtn" src="footer.png" style="width: 100%;">
</div>
<script src="/mplatform/js/jquery-1.11.3.min.js" type="text/javascript"></script>
<script src="/mplatform/js/getData.js" type="text/javascript"></script>
<script>
	var parkList = {};
    var parkProgramList = {};
//        관광지 : 12
//        문화시설 : 14
//        행사/공연/축제 : 15
//        여행코스 : 25
//        레포츠 : 28
//        숙박 : 32
//        쇼핑 : 38
//        음식점 : 39
	$(function(){
   	  $('#pageNo1').click(function(){
		if(parkList.row == null || parkProgramList.row == null)
               getParkList();
           else
               displayArea();
	});
        $(document).on("click","#showMapBtn",function(){
			 JavascriptBridge.showMap(true, $(this).data("lat"), $(this).data("lng"), $(this).data("name"));
		});
		$(document).on("click","#programBtn",function(){
			$('#parkInfo').text($(this).data("name") + " 프로그램");
			$('#parkName').val($(this).data("name"));
			$('#lat').val($(this).data("lat"));
			$('#lng').val($(this).data("lng"));
			 getParkProgramList($(this).data("pidx"));
		});
		$(document).on("click","#partyBtn",function(){
			$('#contentTypeId').val(15)
			$('#parkInfo').text($(this).data("name") + " 주변 행사");
			$('#parkName').val($(this).data("name"));
			$('#lat').val($(this).data("lat"));
			$('#lng').val($(this).data("lng"));
			 getTourist($(this).data("lat"), $(this).data("lng"), $('#contentTypeId').val(), $('#areaCode').val(), $('#sigunguCode').val());
		});
		$(document).on("click","#culturalBtn",function(){
			$('#contentTypeId').val(12)
			$('#parkInfo').text($(this).data("name") + " 주변 관광지");
			$('#parkName').val($(this).data("name"));
			$('#lat').val($(this).data("lat"));
			$('#lng').val($(this).data("lng"));
			 getTourist($(this).data("lat"), $(this).data("lng"), $('#contentTypeId').val());
		});		
		$(document).on("click","#touristBtn",function(){
			$('#contentTypeId').val(14)
			$('#parkInfo').text($(this).data("name") + " 주변 문화시설");
			$('#parkName').val($(this).data("name"));
			$('#lat').val($(this).data("lat"));
			$('#lng').val($(this).data("lng"));
			 getTourist($(this).data("lat"), $(this).data("lng"), $('#contentTypeId').val());
		});
		$(document).on("click","#eateryBtn",function(){
			$('#contentTypeId').val(39)
			$('#parkInfo').text($(this).data("name") + " 주변 음식점");
			$('#parkName').val($(this).data("name"));
			$('#lat').val($(this).data("lat"));
			$('#lng').val($(this).data("lng"));
			 getTourist($(this).data("lat"), $(this).data("lng"), $('#contentTypeId').val());
		});
		$(document).on("click","#kakaoBtn",function(){
			 JavascriptBridge.sendMessage($(this).data("lat"), $(this).data("lng"), $(this).data("img"), $(this).data("name"), $(this).data("addr") );
		});
        $('#backBtn').click(function(){
            var pageNo = parseInt($('#pageIdx').val());
            pageMove(pageNo - 1);
        });
    });
    function compare(a,b) {
      var pat = /(서울특별시) ([가-힣]+)/g;
      var pat2 = /(서울특별시) ([가-힣]+)/g;
      var addr1;
      var addr2;
      if(pat.test(a.P_ADDR)){
            addr1 = RegExp.$2;
      }
      if(pat2.test(b.P_ADDR)){
            addr2 = RegExp.$2;
      }
      if (addr1 < addr2)
        return -1;
      if (addr1 > addr2)
        return 1;
      return 0;
    }
    function pageMove(pageNo){
        $('#main div').hide();
        if(parseInt(pageNo) > 1){
		  $('#header').show();
		  $('#footer').show();
		  $('#main').css("min-height",($(window).height() - $('#footer').height() - $('#header').height() )+"px");
	          $('#main').css("max-height",($(window).height() - $('#footer').height() - $('#header').height() )+"px");
	    	}else{
	    	  $('#header').hide();
	    	  $('#footer').hide();
	    	  $('#main').css("min-height", "100%");
	          $('#main').css("max-height", "100%");
	    	}
	        if(parseInt(pageNo) > 2){
	        	$('#backBtn').show();
	        }else{
	        	$('#backBtn').hide();
	        }
	        $('#pageNo'+pageNo).show();
	        $('#pageNo'+pageNo+' div').show();
	        $('#pageIdx').val(pageNo);
    }
    function setParkList(data){
		parkList.totalCount = data["SearchParkInfoService"]["list_total_count"];
        parkList.row = data["SearchParkInfoService"]["row"];
        parkList.row.sort(compare);
        displayArea();
    }
    function setParkProgramList(data){
		$('#parkProgramList').html('');
		if(data == null || data["SearchProgramsByParkIDService"] == null || data["SearchProgramsByParkIDService"]["row"] == null)
			$('#parkProgramList').append("<div>진행 중인 프로그램이 없습니다.</div>");
		else{
			var list = data["SearchProgramsByParkIDService"]["row"];
			for(var i = 0 ; i < list.length ; i ++){
				var pData = list[i];
				$('#parkProgramList').append("<div><span id='programName'>ㆍ" + pData['P_NAME'] + "</span><br><span>기 간 : "+pData['P_EDUDAY_S']+"</span> ~ <span>"+pData['P_EDUDAY_E']+"</span><br><span>시간 : "+pData['P_EDUTIME']+"</span><br><span>요일 : "+pData['P_PRODAY']+"</span><br><span>대상 : "+pData['P_EDUPERSON']+"</span></div>");
			}
		}
        pageMove(4);
    }
    function getProgramCount(parkId){
        var list = parkProgramList.row;
        var count = 0;
        for(var i = 0 ; i < list.length ; i ++){
        	var pData = list[i];
        	if(pData.P_IDX == parkId)
        	    count++;
        }
        return count;
    }
    function displayArea(){
		$('#areaList').html('');
		var sigunguCode = 1;
        for(var i = 0 ; i < parkList.row.length ; i ++){
            var park = parkList.row[i];
            var pat = /(서울특별시) ([가-힣]+)/g;
            if(pat.test(park.P_ADDR)){
                var areaName = RegExp.$2;
                if( $('#'+areaName).length > 0 ){
                    var count = parseInt($('#' + areaName + ' #count').text())+1;
                    $('#' + areaName + ' #count').text(count);
                }
                else{
                    $('#areaList').append('<div onclick="displayParkList(\''+areaName+'\',\''+(sigunguCode++)+'\');" id="'+areaName+'">'+areaName+' ( 공원 <span id="count">'+1+'</span>개 )</div>');
                 }
            }
        }
        pageMove(2);
        // getParkProgramList('');
    }
    function displayParkList(areaName, sigunguCode){
    	$('#areaPark').text(areaName);
	$('#weatherArea').text(areaName);
    	$('#areaCode').val(1);
    	$('#sigunguCode').val(sigunguCode);
		$('#parkList').html('');
		var isFirst = true;
        for(var i = 0 ; i < parkList.row.length ; i ++){
            var park = parkList.row[i];
            var pat = /(서울특별시) ([가-힣]+)/g;
            if(pat.test(park.P_ADDR)){
                var matchName = RegExp.$2;
                if(matchName == areaName){
			var parkLocationBtn = '<a href="#" id="showMapBtn" data-lat="'+park.LATITUDE+'" data-lng="'+park.LONGITUDE+'" data-name="'+park.P_PARK+'" data-pidx="'+park.P_IDX+'"><img src="btn_location.png" alt="공원위치 보기" width="40" height="51"></a>';
			var programBtn = '<a href="#" id="programBtn" data-lat="'+park.LATITUDE+'" data-lng="'+park.LONGITUDE+'" data-name="'+park.P_PARK+'" data-pidx="'+park.P_IDX+'"><img src="btn_program.png" alt="공원 프로그램 보기" width="40" height="51"></a>';
			var partyBtn = '<a href="#" id="partyBtn" data-lat="'+park.LATITUDE+'" data-lng="'+park.LONGITUDE+'" data-name="'+park.P_PARK+'" data-pidx="'+park.P_IDX+'"><img src="btn_event.png" alt="공원 주변행사 보기" width="40" height="51"></a>';
			var culturalBtn = '<a href="#" id="culturalBtn" data-lat="'+park.LATITUDE+'" data-lng="'+park.LONGITUDE+'" data-name="'+park.P_PARK+'" data-pidx="'+park.P_IDX+'"><img src="btn_facility.png" alt="공원 주변 문화시설 보기" width="40" height="51"></a>';
			var touristBtn = '<a href="#" id="touristBtn" data-lat="'+park.LATITUDE+'" data-lng="'+park.LONGITUDE+'" data-name="'+park.P_PARK+'" data-pidx="'+park.P_IDX+'"><img src="btn_tourist spot.png" alt="공원 주변 관광지 보기" width="40" height="51"></a>';
			var eateryBtn = '<a href="#" id="eateryBtn" data-lat="'+park.LATITUDE+'" data-lng="'+park.LONGITUDE+'" data-name="'+park.P_PARK+'" data-pidx="'+park.P_IDX+'"><img src="btn_restaurant.png" alt="공원 주변 음식점 보기" width="40" height="51"></a>';
			var kakaoBtn = '<a href="#" id="kakaoBtn" data-lat="'+park.LATITUDE+'" data-lng="'+park.LONGITUDE+'" data-name="'+park.P_PARK+'" data-addr="'+park.P_ADDR+'" data-img="'+park.P_IMG+'" ><img src="kakaolink_btn_small.png" alt="카카오톡 링크" width="40" height="51"></a>';
            $('#parkList').append('<div id="'+park.P_IDX +'">ㆍ'+ park.P_PARK + '<br>' + parkLocationBtn + programBtn + partyBtn + culturalBtn + touristBtn + eateryBtn + kakaoBtn + '</div>');
                    if( isFirst ){
						 getWeather(park.LATITUDE, park.LONGITUDE);
						 getPM1025(areaName);
						isFirst = false;
            		}
				}
            }
        }
        pageMove(3);
    }
    function setWeather(data){
    	var xml = $.parseXML(data);
    	$(xml).find('item').each(function(index, node){
    		if($(node).find('category').text() == 'SKY'){
    			//- 하늘상태(SKY) 코드 : 맑음(1), 구름조금(2), 구름많음(3), 흐림(4)
    			var skyVal = parseInt($(node).find('obsrValue').text());
    			if( skyVal == 1 ){
    				$('#'+ $(node).find('category').text() +' span').html("<img src='icon01.png' width='15' height='15'> 맑음");
    			}else if( skyVal == 2 ){
    				$('#'+ $(node).find('category').text() +' span').html("<img src='icon04.png' width='15' height='15'> 구름조금");
    			}else if( skyVal == 3 ){
    				$('#'+ $(node).find('category').text() +' span').html("<img src='icon02.png' width='15' height='15'> 구름많음");
    			}else if( skyVal == 4 ){
    				$('#'+ $(node).find('category').text() +' span').html("<img src='icon03.png' width='15' height='15'> 흐림");
    			}
    		}else{
				if($(node).find('category').text() == 'T1H'){
					$('#'+ $(node).find('category').text() +' span').text(Math.floor(parseFloat($(node).find('obsrValue').text())*10)/10);
				}else if($(node).find('category').text() == 'PTY'){
					//- 강수형태(PTY) 코드 : 없음(0), 비(1), 비/눈(2), 눈(3)
					var skyVal = parseInt($(node).find('obsrValue').text());
					if( skyVal == 1 ){
						$('#'+ $(node).find('category').text() +' span').html("비");
					}else if( skyVal == 2 ){
						$('#'+ $(node).find('category').text() +' span').html("비/눈");
					}else if( skyVal == 3 ){
						$('#'+ $(node).find('category').text() +' span').html("눈");
    				}else{
    					$('#'+ $(node).find('category').text() +' span').html("없음");
    				}
				}else{
					$('#'+ $(node).find('category').text() +' span').text($(node).find('obsrValue').text());
				}
    		}
    	});
    }
    function setTourist(data){
    	var xml = $.parseXML(data);
		$('#parkProgramList').html('');
    	$(xml).find('item').each(function(index, node){
    		var title = $(node).find("title").text();
    		var dist = parseInt($(node).find("dist").text());
    		var lng = $(node).find("mapx").text();
    		var lat = $(node).find("mapy").text();
    		var tel = $(node).find("tel").text();
			var contentId = $(node).find("contentid").text();
			console.log(contentId);
			var contentTypeId = $(node).find("contenttypeid").text();
			var addr = $(node).find("addr1").text()+$(node).find("addr2").text();
			var img = $(node).find("firstimage").text();
			if(img == null || img == "")
				img = "https://parkminkyu.github.io/mplatform/kakaolink_btn_small.png";
			title = (title.replace(/"/gi,''));
			title = (title.replace(/'/gi,''));
			addr = (addr.replace(/"/gi,''));
			addr = (addr.replace(/"/gi,''));
    		if($(node).find("contenttypeid").text() == "15"){
    			dist = parseInt(calculateDistance($('#lat').val(), $('#lng').val(), lat, lng) * 1000);
    		}
    		if(dist > 1000){
    			dist = dist/1000 + " Km"
    		}else{
    			dist = dist + " m"
    		}
    		var parkLocationBtn = "<a href='#' id='targetMapBtn' onclick='showMapAndTarget(\""+lat+"\",\""+lng+"\",\""+title+"\");'><img src='btn_location.png' alt='공원위치 보기' width='40' height='51'></a>";
    		var telBtn = "<a href=\"tel:"+tel+"\"><img src='btn_call.png' width='40' height='51'></a>";
			var kakaoBtn = '<a href="#" id="kakaoBtn" data-lat="'+lat+'" data-lng="'+lng+'" data-name="'+title+'" data-addr="'+addr+'" data-img="'+img+'" ><img src="kakaolink_btn_small.png" alt="카카오톡 링크"  width="40" height="51"></a>';
			var detailArea = '<ul id="detailArea"><li id="detailBtn'+contentId+'" class="detailBtn" onclick="showDetail(\''+contentId+'\',\''+contentTypeId+'\');"><span style="border: 1px solid #82a56f; margin:5px;padding:5px;background:#bad3ad;">상세보기▼</span></li><li id="detailIntro'+contentId+'" style="display: none;"></li><li id="detailInfo'+contentId+'" style="display: none;"></li></ul>';
			if($(node).find("contenttypeid").text() == "15"){
				$('#parkProgramList').append("<div><span id='programName'>ㆍ" + title + " ("+dist+")</span><br><span>기 간 : "+$(node).find("eventstartdate").text()+"</span> ~ <span>"+$(node).find("eventenddate").text()+"</span><br>"+parkLocationBtn+ telBtn+ kakaoBtn+"<br>"+detailArea+"</div>");
			}else{
				$('#parkProgramList').append("<div><span id='programName'>ㆍ"+title+" ("+dist+")</span><br><span>주소 : "+addr+"</sapn><br>"+parkLocationBtn+ telBtn+kakaoBtn+"<br>"+detailArea+"</div>");
			}
    	});
    	pageMove(4);
    }
	function showDetail(contentId, contentTypeId){
		if($('#detailIntro'+contentId).is(":visible") == false){
			getDetailIntro(contentId, contentTypeId);
			getDetailInfo(contentId, contentTypeId);
			$('#detailBtn'+contentId+' span').text("상세보기▲");
		}else{
			$('#detailBtn'+contentId+' span').text("상세보기▼");
		}
		$('#detailIntro'+contentId).toggle();
		$('#detailInfo'+contentId).toggle();
	}
	function setDetailIntro(data){
		var xml = $.parseXML(data);
		var html = "<br>";
		var contentId = '';
    	$(xml).find('item').each(function(index, node){
    		var childNodes = node.childNodes;
    		contentId = $(node).find("contentid").text();
    		var contentTypeId = $(node).find("contenttypeid").text();
    		for(var i = 0 ; i < childNodes.length ; i ++){
    			var child = childNodes[i];
    			if(child.nodeName != 'contentid' && child.nodeName != 'contenttypeid'){
    				html+="<span id='infoName'>"+getDetailTitle(contentTypeId, child.nodeName)+"</span> : <span>"+node.childNodes[i].textContent+"</span><br>";
    			}
    		}
		});
		$('#detailIntro'+contentId).html(html);
	}
	function setDetailInfo(data){
		var xml = $.parseXML(data);
		var html = "<br>";
		var contentId = '';
    	$(xml).find('item').each(function(index, node){
			var infoname = $(node).find("infoname").text();
			var infotext = $(node).find("infotext").text();
			contentId = $(node).find("contentid").text();
			html+="<span id='infoName'>"+infoname+"</span><br><span>"+infotext+"</span><br><br>";
		});
		$('#detailInfo'+contentId).html(html);
	}
	function setPM1025(data){
    	var xml = $.parseXML(data);
    	$(xml).find('item').each(function(index, node){
			//- 0~30: 좋음, 31~80: 보통, 81~150: 나쁨, 151~: 매우나쁨
			var pm10 = parseInt($(node).find('pm10Value').text());
			//- 0~15: 좋음, 16~50: 보통, 51~100: 나쁨, 101~: 매우나쁨
			var pm25 = parseInt($(node).find('pm25Value').text());
			if(pm10 <= 30){
				pm10 = "<span style='width:10px;background:#4e89f6;'>&nbsp;좋    음&nbsp;</span>&nbsp;" + pm10;
			}else if(pm10 <= 80){
				pm10 = "<span style='width:10px;background:#5bd464;'>&nbsp;보    통&nbsp;</span>&nbsp;" + pm10;
			}else if(pm10 <= 150){
				pm10 = "<span style='width:10px;background:#fe7f41;'>&nbsp;나    쁨&nbsp;</span>&nbsp;" + pm10;
			}else if(pm10 > 150){
				pm10 = "<span style='width:10px;background:#f94a4b;'>&nbsp;매우나쁨&nbsp;</span>&nbsp;" + pm10;
			}else{
				pm10 = "<span style='width:10px;background:#fff;'>측정값없음</span>&nbsp;" + pm10;
			}
			if(pm25 <= 15){
				pm25 = "<span style='width:10px;background:#4e89f6;'>&nbsp;좋    음&nbsp;</span>&nbsp;" + pm25;
			}else if(pm25 <= 50){
				pm25 = "<span style='width:10px;background:#5bd464;'>&nbsp;보    통&nbsp;</span>&nbsp;" + pm25;
			}else if(pm25 <= 100){
				pm25 = "<span style='width:10px;background:#fe7f41;'>&nbsp;나    쁨&nbsp;</span>&nbsp;" + pm25;
			}else{
				pm25 = "<span style='width:10px;background:#f94a4b;'>&nbsp;매우나쁨&nbsp;</span>&nbsp;" + pm25;
			}
    		$('#pm10Value span').html(pm10);
		$('#pm25Value span').html(pm25);
    	});
    }
    function showMapAndTarget(lat, lng, title){
    	$('#targetName').val($('#parkName').val() + "," + title);
		$('#targetLat').val($('#lat').val() + "," + lat);
		$('#targetLng').val($('#lng').val() + "," + lng);
		var title = $('#targetName').val();
		var lat = $('#targetLat').val();
		var lng = $('#targetLng').val();
		 JavascriptBridge.showMap(false, lat, lng, title);
    }
    function calculateDistance(lat1, lon1, lat2, lon2) {
      var R = 6371; // km
      var dLat = toRad((lat2-lat1));
      var dLon = toRad((lon2-lon1));
      var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
              Math.sin(dLon/2) * Math.sin(dLon/2);
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      var d = R * c;
      return d;
    }
    function toRad(num){
    	return num * Math.PI / 180;
    }
</script>
</body>
</html>
